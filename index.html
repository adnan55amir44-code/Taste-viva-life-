<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taste Viva Life | Premium Food & Recipes</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Pacifico&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        :root {
            --brand-color: #ff4757;
            --secondary-color: #2ed573;
            --accent-color: #ffa502;
            --dark-bg: #1e272e;
            --light-bg: #f5f6fa;
            --glass: rgba(255, 255, 255, 0.9);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Quicksand', sans-serif; }
        body { background: var(--light-bg); color: var(--dark-bg); scroll-behavior: smooth; overflow-x: hidden; }

        /* --- Custom Animations --- */
        @keyframes shine { 100% { left: 125%; } }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(255, 71, 87, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0); } }
        @keyframes gradientLogo { 0% { color: #ff4757; } 50% { color: #ffa502; } 100% { color: #2ed573; } }

        /* --- Header --- */
        header {
            position: fixed; top: 0; width: 100%; padding: 15px 5%;
            background: var(--glass); backdrop-filter: blur(10px);
            display: flex; justify-content: space-between; align-items: center;
            z-index: 1000; box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .logo { font-family: 'Pacifico', cursive; font-size: 2rem; animation: gradientLogo 5s infinite; cursor: pointer; }
        
        nav ul { display: flex; list-style: none; gap: 20px; }
        nav a { text-decoration: none; color: #333; font-weight: bold; font-size: 0.95rem; transition: 0.3s; }
        nav a:hover { color: var(--brand-color); transform: scale(1.1); }

        /* --- User Auth Display --- */
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .user-name {
            color: var(--brand-color);
            font-weight: bold;
        }
        .btn-logout {
            background: #ff6b81;
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* --- Star Rating Styles --- */
        .star-rating {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            cursor: pointer;
            justify-content: center;
        }

        .star-rating i {
            font-size: 28px;
            color: #ddd;
            transition: all 0.3s;
        }

        .star-rating i:hover {
            transform: scale(1.2);
        }

        .star-rating i.selected {
            color: gold;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .star-rating i.hovered {
            color: #ffd700;
        }

        /* --- Global Button Design --- */
        .btn-modern {
            padding: 12px 30px; border-radius: 50px; border: none; 
            background: linear-gradient(45deg, var(--brand-color), #ff6b81);
            color: white; font-weight: bold; cursor: pointer; position: relative;
            overflow: hidden; transition: 0.4s; box-shadow: 0 5px 15px rgba(255, 71, 87, 0.3);
        }
        .btn-modern:after {
            content: ''; position: absolute; top: 0; left: -75%; width: 50%; height: 100%;
            background: rgba(255, 255, 255, 0.2); transform: skewX(-25deg);
        }
        .btn-modern:hover:after { animation: shine 0.75s; }
        .btn-modern:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(255, 71, 87, 0.5); }

        /* --- Sections Layout --- */
        section { padding: 100px 8%; min-height: 80vh; border-bottom: 1px solid #eee; }
        .title-center { text-align: center; margin-bottom: 50px; }
        .title-center h2 { font-size: 3rem; font-family: 'Montserrat', sans-serif; color: var(--dark-bg); }
        .title-center p { color: #7f8c8d; font-size: 1.1rem; }

        /* --- 1. HOME SECTION (Banner) --- */
        #home {
            height: 100vh; background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://source.unsplash.com/1600x900/?cooking,chef');
            background-size: cover; background-position: center; display: flex;
            flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center;
        }
        #home h1 { font-size: 4.5rem; text-shadow: 2px 2px 10px rgba(0,0,0,0.5); }
        .search-area { background: white; padding: 10px; border-radius: 50px; display: flex; width: 90%; max-width: 600px; margin-top: 30px; }
        .search-area input { flex: 1; border: none; outline: none; padding-left: 20px; font-size: 1rem; }

        /* --- 2. ABOUT SECTION --- */
        #about { background: white; display: flex; align-items: center; gap: 50px; flex-wrap: wrap; }
        .about-text { flex: 1; min-width: 300px; }
        .about-img { flex: 1; min-width: 300px; border-radius: 20px; overflow: hidden; box-shadow: 20px 20px 0 var(--brand-color); }
        .about-img img { width: 100%; transition: 0.5s; }
        .about-img:hover img { transform: scale(1.1); }

        /* --- 3. ALL RECIPE SECTION --- */
        .recipe-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }
        .recipe-card {
            background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            transition: 0.4s; border: 1px solid #eee; position: relative;
        }
        .recipe-card:hover { transform: scale(1.03); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .recipe-img { width: 100%; height: 230px; object-fit: cover; }
        .recipe-content { padding: 25px; }

        /* --- PDF Lock Overlay --- */
        .pdf-lock-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 20px;
            opacity: 0;
            transition: opacity 0.3s;
            padding: 20px;
            text-align: center;
        }
        .recipe-card:hover .pdf-lock-overlay {
            opacity: 1;
        }

        /* --- 4. SERVICES SECTION --- */
        #services { background: var(--dark-bg); color: white; }
        #services .title-center h2 { color: white; }
        .service-container { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; }
        .service-box {
            background: rgba(255,255,255,0.05); padding: 40px; border-radius: 20px; width: 350px;
            text-align: center; transition: 0.4s; border: 1px solid rgba(255,255,255,0.1);
        }
        .service-box:hover { background: var(--brand-color); transform: translateY(-10px); }
        .service-box i { font-size: 3rem; margin-bottom: 20px; color: var(--accent-color); }

        /* --- 5. CONTACT SECTION --- */
        .contact-flex { display: flex; gap: 40px; flex-wrap: wrap; }
        .contact-info { flex: 1; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .contact-form { flex: 1.5; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .form-group input, .form-group textarea { width: 100%; padding: 15px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 10px; }

        /* --- HIGH-CLICK BANNER AD STYLES --- */
        #premiumBannerAd {
            max-width: 728px;
            margin: 25px auto;
            text-align: center;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(255, 71, 87, 0.25);
            border: 2px solid #ff4757;
            position: relative;
        }
        #bannerAdContainer {
            background: #f8f9fa;
            padding: 15px;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- Floating Elements --- */
        .whatsapp-float {
            position: fixed; bottom: 30px; right: 30px; background: #25D366; color: white;
            width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center;
            align-items: center; font-size: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            z-index: 1000; cursor: pointer; animation: pulse-red 2s infinite;
        }

        /* --- Modal --- */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center;
        }
        .modal-box { 
            background: white; 
            padding: 40px; 
            border-radius: 20px; 
            width: 90%; 
            max-width: 400px; 
            text-align: center;
            position: relative;
        }
        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        .modal-input {
            width: 100%;
            padding: 12px 15px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        /* --- Toast Notification --- */
        .toast {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 15px 25px;
            background: var(--brand-color);
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 3000;
            transform: translateX(150%);
            transition: transform 0.3s;
        }
        .toast.show {
            transform: translateX(0);
        }

        /* --- Responsive --- */
        @media (max-width: 768px) {
            #home h1 { font-size: 2.5rem; }
            header { flex-direction: column; gap: 10px; }
            nav ul { gap: 10px; font-size: 0.8rem; }
            .user-info {
                flex-direction: column;
                gap: 5px;
            }
            #premiumBannerAd {
                margin: 15px auto;
                border-radius: 8px;
            }
            #bannerAdContainer {
                padding: 10px;
                min-height: 70px;
            }
            .star-rating i {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">Taste Viva Life</div>
        <nav>
            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#recipes">Recipes</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="#contact">Contact</a></li>
                <li><a href="#privacy">Privacy</a></li>
            </ul>
        </nav>
        <div id="authButtons">
            <!-- Dynamic content will be inserted here -->
        </div>
    </header>

    <section id="home">
        <h1 class="animate__animated animate__fadeInDown">Taste the Life with Taste Viva</h1>
        <p class="animate__animated animate__fadeInUp">Premium Quality Recipes & Food Consultancy</p>
        <div class="search-area animate__animated animate__zoomIn">
            <input type="text" id="recipeSearch" placeholder="Search for recipes (Biryani, Pasta...)" onkeyup="searchFun()">
            <button class="btn-modern"><i class="fas fa-search"></i></button>
        </div>
    </section>

    <section id="about">
        <div class="about-img">
            <img src="https://source.unsplash.com/600x400/?chef-cooking" alt="About Us">
        </div>
        <div class="about-text">
            <h2>About Taste Viva Life</h2>
            <p style="margin: 20px 0; line-height: 1.8;">Welcome to <b>Taste Viva Life</b>. Hum aapko behtareen recipes aur food services provide karte hain. Hamara maqsad har ghar mein hotel jaisa zayeqa pohanchana hai. Hamari recipes expert chefs ki taraf se banayi jati hain jo SEO friendly aur easy to follow hain.</p>
            <button class="btn-modern">Learn More</button>
        </div>
    </section>

    <section id="recipes">
        <div class="title-center">
            <h2>Our Special Recipes</h2>
            <p>Download PDF for complete step-by-step guides</p>
        </div>
        
        <!-- =========================================== -->
        <!-- HIGH-CLICK BANNER AD - OPTIMAL PLACEMENT -->
        <!-- Positioned right before recipes for maximum CTR -->
        <!-- =========================================== -->
        <div id="premiumBannerAd">
            <!-- Banner Headline -->
            <div style="
                background: linear-gradient(90deg, #ff4757, #ff6b81);
                color: white;
                padding: 12px;
                font-weight: bold;
                font-size: 1.1rem;
                font-family: 'Montserrat', sans-serif;
            ">
                <i class="fas fa-crown"></i> PREMIUM PARTNER OFFER
            </div>
            
            <!-- Banner Iframe - Your Ad Code -->
            <div id="bannerAdContainer">
                <script>
                  atOptions = {
                    'key' : '54081a728fab0b99a7637ef5cba7c973',
                    'format' : 'iframe',
                    'height' : 60,
                    'width' : 468,
                    'params' : {}
                  };
                </script>
                <script src="https://www.highperformanceformat.com/54081a728fab0b99a7637ef5cba7c973/invoke.js"></script>
            </div>
            
            <!-- Action Button -->
            <div style="
                background: #f1f2f6;
                padding: 12px;
                border-top: 1px dashed #ddd;
            ">
                <button onclick="trackBannerClick()" style="
                    background: linear-gradient(45deg, #2ed573, #1dd1a1);
                    color: white;
                    border: none;
                    padding: 10px 25px;
                    border-radius: 50px;
                    font-weight: bold;
                    cursor: pointer;
                    transition: 0.3s;
                    box-shadow: 0 4px 10px rgba(46, 213, 115, 0.3);
                ">
                    <i class="fas fa-external-link-alt"></i> Click for Special Food Offers
                </button>
                <p style="margin-top: 8px; font-size: 0.85rem; color: #666;">
                    Click-through rate (CTR) helps us improve your experience.
                </p>
            </div>
        </div>

        <div class="recipe-grid" id="recipeList">
            <!-- Recipes will be loaded here -->
        </div>
    </section>

    <section id="services">
        <div class="title-center">
            <h2>Paid Services</h2>
            <p>Aap humse niche di gayi premium services le sakte hain.</p>
        </div>
        <div class="service-container">
            <div class="service-box">
                <i class="fas fa-utensils"></i>
                <h3>Menu Planning</h3>
                <p>Hum aapke event ya restaurant ke liye mukammal menu plan karte hain.</p>
                <button class="btn-modern" style="margin-top:20px;" onclick="contactService('Menu Planning')">Buy Now</button>
            </div>
            <div class="service-box">
                <i class="fas fa-video"></i>
                <h3>Online Classes</h3>
                <p>Private classes for learning international cuisines.</p>
                <button class="btn-modern" style="margin-top:20px;" onclick="contactService('Online Class')">Join Now</button>
            </div>
        </div>
    </section>

    <section id="contact">
        <div class="title-center">
            <h2>Contact Us</h2>
            <p>Hum 2 ghante mein aapka jawab denge.</p>
        </div>
        <div class="contact-flex">
            <div class="contact-info">
                <h3>Direct Connect</h3>
                <p style="margin: 20px 0;"><i class="fas fa-envelope"></i> <a href="mailto:adnan55amir44@gmail.com">adnan55amir44@gmail.com</a></p>
                <p><i class="fab fa-whatsapp"></i> +92 319 4879958</p>
                <hr style="margin: 20px 0;">
                <p>Agar koi recipe kaam nahi kar rahi ya koi shikayat hai, toh be-jijhak humse raabta karein.</p>
            </div>
            <div class="contact-form">
                <div class="form-group">
                    <input type="text" id="reviewName" placeholder="Your Name" required>
                    <textarea id="reviewText" rows="5" placeholder="Your Message / Review" required></textarea>
                    <!-- Star Rating Container -->
                    <div class="star-rating">
                        <i class="fas fa-star" data-value="1"></i>
                        <i class="fas fa-star" data-value="2"></i>
                        <i class="fas fa-star" data-value="3"></i>
                        <i class="fas fa-star" data-value="4"></i>
                        <i class="fas fa-star" data-value="5"></i>
                    </div>
                    <button class="btn-modern" id="submitFeedbackBtn" onclick="submitReview()">Send Feedback</button>
                </div>
            </div>
        </div>
    </section>

    <section id="privacy" style="background: #f1f2f6;">
        <div class="title-center">
            <h2>Privacy Policy</h2>
        </div>
        <div style="max-width: 800px; margin: 0 auto; background: white; padding: 40px; border-radius: 20px;">
            <p><b>Note:</b> Taste Viva Life ek professional platform hai. Faltu messages ya spamming karne wale users ko foran <b>Block</b> kar diya jayega. Hum aapki privacy ka pura khayal rakhte hain aur aapka data kisi teesre bande ko share nahi kiya jata.</p>
        </div>
    </section>

    <footer style="padding: 40px; text-align:center; background: #333; color: white;">
        <p>© 2025 Taste Viva Life | Designed for Perfection</p>
    </footer>

    <div class="whatsapp-float" onclick="whatsappRedirect('General Inquiry')">
        <i class="fab fa-whatsapp"></i>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="modal">
        <div class="modal-box">
            <span class="close-modal" onclick="closeAuth()">&times;</span>
            <h2 id="mTitle">Login</h2>
            <div id="signupOnly" style="display:none;">
                <input type="text" id="mName" class="modal-input" placeholder="Full Name">
                <input type="text" id="mPhone" class="modal-input" placeholder="WhatsApp Number">
            </div>
            <input type="email" id="mEmail" class="modal-input" placeholder="Email">
            <input type="password" id="mPass" class="modal-input" placeholder="Password">
            <button class="btn-modern" style="width:100%; margin-top: 20px;" onclick="performAuth()">Submit</button>
            <p onclick="toggleAuth()" id="mToggle" style="margin-top:15px; cursor:pointer; color:blue;">New Account?</p>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyARB_fC7Pe0pFeDvtSDak2R3Qcgnn4QS6A",
            authDomain: "taste-viva-pro.firebaseapp.com",
            databaseURL: "https://taste-viva-pro-default-rtdb.firebaseio.com",
            projectId: "taste-viva-pro",
            storageBucket: "taste-viva-pro.firebasestorage.app",
            messagingSenderId: "970610712940",
            appId: "1:970610712940:web:b40783c8074b26693c5349"
        };
        
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        const db = firebase.database();
        const auth = firebase.auth();
        
        // --- Global Variables ---
        let isLogin = true;
        let currentUser = null;
        let pendingPdfUrl = null;
        let selectedRating = 0;  // Star rating variable
        
        // --- Banner Tracking Variables ---
        let bannerClickCount = 0;
        const BANNER_ID = 'premium_food_banner_001';

        // --- Toast Notification Function ---
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = isError ? '#ff4757' : '#2ed573';
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // --- Star Rating Functions ---
        function initStarRating() {
            const stars = document.querySelectorAll('.star-rating i');
            
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const value = parseInt(this.getAttribute('data-value'));
                    selectedRating = value;
                    updateStars(value);
                    showToast(`Rated ${value} star${value > 1 ? 's' : ''}`);
                });
                
                star.addEventListener('mouseenter', function() {
                    const value = parseInt(this.getAttribute('data-value'));
                    updateStars(value, true);
                });
                
                star.addEventListener('mouseleave', function() {
                    updateStars(selectedRating);
                });
            });
        }

        function updateStars(rating, isHover = false) {
            const stars = document.querySelectorAll('.star-rating i');
            
            stars.forEach(star => {
                const starValue = parseInt(star.getAttribute('data-value'));
                
                if (isHover) {
                    star.classList.toggle('hovered', starValue <= rating);
                    star.classList.remove('selected');
                } else {
                    star.classList.toggle('selected', starValue <= rating);
                    star.classList.remove('hovered');
                }
            });
        }

        // --- Auth State Observer ---
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            updateAuthUI();
            
            if (user && pendingPdfUrl) {
                // User just logged in and there's a pending PDF download
                window.open(pendingPdfUrl, '_blank');
                pendingPdfUrl = null;
            }
        });

        // --- Update UI Based on Auth State ---
        function updateAuthUI() {
            const authButtons = document.getElementById('authButtons');
            
            if (currentUser) {
                // User is logged in
                authButtons.innerHTML = `
                    <div class="user-info">
                        <span class="user-name">${currentUser.email ? currentUser.email.split('@')[0] : 'User'}</span>
                        <button class="btn-logout" onclick="logout()">Logout</button>
                    </div>
                `;
            } else {
                // User is not logged in
                authButtons.innerHTML = `
                    <button class="btn-modern" onclick="openAuth('login')">Login / Sign Up</button>
                `;
            }
        }

        // --- Banner Click Tracking Function ---
        function trackBannerClick() {
            bannerClickCount++;
            
            // Show visual feedback
            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i> Redirecting...';
            btn.style.background = 'linear-gradient(45deg, #ffa502, #ffbe76)';
            
            // Track in Firebase if user is logged in
            if (currentUser) {
                db.ref('bannerClicks/' + currentUser.uid).push({
                    bannerId: BANNER_ID,
                    clickedAt: firebase.database.ServerValue.TIMESTAMP,
                    userEmail: currentUser.email,
                    pageLocation: window.location.hash || 'home'
                }).then(() => {
                    console.log('Banner click tracked successfully');
                }).catch(error => {
                    console.error('Tracking error:', error);
                });
            }
            
            // Calculate and show CTR (simulated for demo)
            setTimeout(() => {
                const simulatedImpressions = 1000;
                const simulatedCTR = ((bannerClickCount / simulatedImpressions) * 100).toFixed(2);
                showToast(`Banner CTR: ${simulatedCTR}% | Thank you!`);
            }, 500);
            
            // Reset button after 1.5 seconds
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = 'linear-gradient(45deg, #2ed573, #1dd1a1)';
            }, 1500);
        }

        // --- Auth Functions ---
        function openAuth(type) {
            if (type === 'signup') {
                isLogin = false;
                document.getElementById('mTitle').innerText = "Sign Up";
                document.getElementById('signupOnly').style.display = 'block';
                document.getElementById('mToggle').innerText = "Already have an account? Login";
            } else {
                isLogin = true;
                document.getElementById('mTitle').innerText = "Login";
                document.getElementById('signupOnly').style.display = 'none';
                document.getElementById('mToggle').innerText = "New Account? Sign Up";
            }
            
            // Clear form
            document.getElementById('mName').value = '';
            document.getElementById('mPhone').value = '';
            document.getElementById('mEmail').value = '';
            document.getElementById('mPass').value = '';
            
            document.getElementById('authModal').style.display = 'flex';
        }

        function closeAuth() {
            document.getElementById('authModal').style.display = 'none';
        }

        function toggleAuth() {
            isLogin = !isLogin;
            if (isLogin) {
                document.getElementById('mTitle').innerText = "Login";
                document.getElementById('signupOnly').style.display = 'none';
                document.getElementById('mToggle').innerText = "New Account? Sign Up";
            } else {
                document.getElementById('mTitle').innerText = "Sign Up";
                document.getElementById('signupOnly').style.display = 'block';
                document.getElementById('mToggle').innerText = "Already have an account? Login";
            }
        }

        function performAuth() {
            const email = document.getElementById('mEmail').value;
            const password = document.getElementById('mPass').value;
            
            if (!email || !password) {
                showToast("Please fill email and password", true);
                return;
            }
            
            if (isLogin) {
                // Login
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        showToast("Welcome back!");
                        closeAuth();
                    })
                    .catch((error) => {
                        let errorMessage = "Login failed. ";
                        switch(error.code) {
                            case 'auth/user-not-found':
                                errorMessage += "User not found.";
                                break;
                            case 'auth/wrong-password':
                                errorMessage += "Wrong password.";
                                break;
                            case 'auth/invalid-email':
                                errorMessage += "Invalid email.";
                                break;
                            default:
                                errorMessage += error.message;
                        }
                        showToast(errorMessage, true);
                    });
            } else {
                // Sign Up
                const name = document.getElementById('mName').value;
                const phone = document.getElementById('mPhone').value;
                
                if (!name || !phone) {
                    showToast("Please fill all fields", true);
                    return;
                }
                
                if (password.length < 6) {
                    showToast("Password must be at least 6 characters", true);
                    return;
                }
                
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        
                        // Save additional user info to database
                        return db.ref('users/' + user.uid).set({
                            name: name,
                            phone: phone,
                            email: email,
                            createdAt: firebase.database.ServerValue.TIMESTAMP
                        });
                    })
                    .then(() => {
                        showToast("Account created successfully!");
                        closeAuth();
                    })
                    .catch((error) => {
                        let errorMessage = "Sign up failed. ";
                        switch(error.code) {
                            case 'auth/email-already-in-use':
                                errorMessage += "Email already in use. Try login.";
                                break;
                            case 'auth/weak-password':
                                errorMessage += "Password too weak.";
                                break;
                            case 'auth/invalid-email':
                                errorMessage += "Invalid email.";
                                break;
                            default:
                                errorMessage += error.message;
                        }
                        showToast(errorMessage, true);
                    });
            }
        }

        function logout() {
            auth.signOut()
                .then(() => {
                    showToast("Logged out successfully");
                    updateAuthUI();
                })
                .catch((error) => {
                    showToast("Logout failed: " + error.message, true);
                });
        }

        // --- Recipe Functions ---
        function loadRecipes() {
            // Default recipes if Firebase is not accessible
            const defaultRecipes = [
                {
                    id: 1,
                    title: "Chicken Biryani",
                    description: "Authentic Hyderabadi style chicken biryani recipe",
                    image: "https://source.unsplash.com/300x230/?biryani",
                    pdf: "https://example.com/biryani-recipe.pdf"
                },
                {
                    id: 2,
                    title: "Butter Chicken",
                    description: "Creamy and delicious butter chicken recipe",
                    image: "https://source.unsplash.com/300x230/?butter-chicken",
                    pdf: "https://example.com/butter-chicken-recipe.pdf"
                },
                {
                    id: 3,
                    title: "Vegetable Pasta",
                    description: "Healthy vegetable pasta with Italian herbs",
                    image: "https://source.unsplash.com/300x230/?pasta",
                    pdf: "https://example.com/pasta-recipe.pdf"
                },
                {
                    id: 4,
                    title: "Chocolate Cake",
                    description: "Moist chocolate cake with frosting",
                    image: "https://source.unsplash.com/300x230/?chocolate-cake",
                    pdf: "https://example.com/cake-recipe.pdf"
                }
            ];

            const recipeList = document.getElementById('recipeList');
            
            // Try to load from Firebase
            try {
                db.ref('recipes').once('value')
                    .then((snapshot) => {
                        if (snapshot.exists()) {
                            const recipes = snapshot.val();
                            displayRecipes(recipes);
                        } else {
                            // Use default recipes
                            displayRecipes(defaultRecipes);
                        }
                    })
                    .catch((error) => {
                        console.error("Error loading recipes:", error);
                        displayRecipes(defaultRecipes);
                    });
            } catch (error) {
                console.error("Firebase error:", error);
                displayRecipes(defaultRecipes);
            }
        }

        function displayRecipes(recipes) {
            const recipeList = document.getElementById('recipeList');
            recipeList.innerHTML = '';
            
            // Convert object to array if needed
            const recipesArray = Array.isArray(recipes) ? recipes : Object.values(recipes);
            
            recipesArray.forEach(recipe => {
                recipeList.innerHTML += `
                    <div class="recipe-card">
                        <img src="${recipe.image}" class="recipe-img" alt="${recipe.title}">
                        <div class="recipe-content">
                            <h3>${recipe.title}</h3>
                            <p>${recipe.description}</p>
                            <button class="btn-modern" style="margin-top:15px; width:100%;" 
                                onclick="downloadRecipePdf('${recipe.pdf}', '${recipe.title}')">
                                Download PDF
                            </button>
                        </div>
                        <div class="pdf-lock-overlay">
                            <i class="fas fa-lock" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>Login required to download PDF</p>
                        </div>
                    </div>
                `;
            });
        }

        function downloadRecipePdf(pdfUrl, recipeTitle) {
            if (!currentUser) {
                pendingPdfUrl = pdfUrl;
                showToast("Please login first to download PDF", true);
                openAuth('login');
            } else {
                // Track download in database
                db.ref('downloads/' + currentUser.uid).push({
                    recipe: recipeTitle,
                    pdfUrl: pdfUrl,
                    downloadedAt: firebase.database.ServerValue.TIMESTAMP
                }).then(() => {
                    // Open PDF in new tab
                    window.open(pdfUrl, '_blank');
                    showToast(`Downloading ${recipeTitle} PDF`);
                }).catch(error => {
                    showToast("Failed to track download: " + error.message, true);
                });
            }
        }

        // --- FEEDBACK SUBMISSION FUNCTION WITH STAR RATING ---
        function submitReview() {
            const name = document.getElementById('reviewName').value.trim();
            const text = document.getElementById('reviewText').value.trim();
            const button = document.getElementById('submitFeedbackBtn');
            
            if (!name || !text) {
                showToast("Please fill all fields", true);
                return;
            }
            
            if (text.length < 10) {
                showToast("Review must be at least 10 characters", true);
                return;
            }
            
            if (selectedRating === 0) {
                showToast("Please select a rating by clicking on stars", true);
                return;
            }
            
            // Disable button to prevent multiple clicks
            button.disabled = true;
            const originalText = button.textContent;
            button.textContent = "Sending...";
            
            // Create review data WITH RATING
            const reviewData = {
                name: name,
                text: text,
                rating: selectedRating,  // Add rating here
                timestamp: Date.now(),
                date: new Date().toISOString(),
                userEmail: currentUser ? currentUser.email : 'Anonymous',
                userId: currentUser ? currentUser.uid : 'anonymous',
                status: 'new'
            };
            
            // Save to Firebase
            db.ref('reviews').push(reviewData)
                .then(() => {
                    // Success
                    showToast(`✓ Thank you! Your ${selectedRating}-star rating has been submitted.`);
                    
                    // Clear form and reset rating
                    document.getElementById('reviewName').value = '';
                    document.getElementById('reviewText').value = '';
                    selectedRating = 0;
                    updateStars(0);
                    
                    // Log success
                    console.log('Feedback with rating saved to Firebase:', reviewData);
                    
                    // Also save to local storage for backup
                    try {
                        const localReviews = JSON.parse(localStorage.getItem('tasteviva_reviews') || '[]');
                        localReviews.push({
                            ...reviewData,
                            localSaved: true
                        });
                        localStorage.setItem('tasteviva_reviews', JSON.stringify(localReviews));
                        console.log('Feedback with rating saved to local storage');
                    } catch (e) {
                        console.log('Local storage save skipped');
                    }
                })
                .catch((error) => {
                    // Error
                    console.error('Firebase error:', error);
                    showToast("Error: Could not submit feedback. Please try again.", true);
                    
                    // Fallback: Save to local storage
                    try {
                        const localReviews = JSON.parse(localStorage.getItem('tasteviva_reviews') || '[]');
                        localReviews.push({
                            ...reviewData,
                            error: error.message,
                            localSaved: true
                        });
                        localStorage.setItem('tasteviva_reviews', JSON.stringify(localReviews));
                        showToast("Feedback saved locally. We'll sync when online.");
                    } catch (e) {
                        showToast("Please check your internet connection", true);
                    }
                })
                .finally(() => {
                    // Re-enable button
                    button.disabled = false;
                    button.textContent = originalText;
                });
        }

        // --- Initialize Database Structure ---
        function initializeDatabase() {
            // Check if reviews node exists, if not create it
            db.ref('reviews').once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        // Create initial structure
                        db.ref('reviews').set({
                            welcome: {
                                name: "Admin",
                                text: "Welcome to Taste Viva Life feedback system!",
                                rating: 5,
                                timestamp: Date.now(),
                                userEmail: "admin@tasteviva.com",
                                status: "active"
                            }
                        }).then(() => {
                            console.log("Database initialized successfully");
                        });
                    } else {
                        console.log("Database already initialized");
                    }
                })
                .catch(error => {
                    console.error("Database check error:", error);
                });
        }

        // --- Sync Local Reviews to Firebase ---
        function syncLocalReviews() {
            try {
                const localReviews = JSON.parse(localStorage.getItem('tasteviva_reviews') || '[]');
                if (localReviews.length > 0 && currentUser) {
                    console.log(`Found ${localReviews.length} local reviews to sync`);
                    
                    localReviews.forEach(review => {
                        if (review.localSaved && !review.synced) {
                            db.ref('reviews').push({
                                name: review.name,
                                text: review.text,
                                rating: review.rating,
                                timestamp: review.timestamp,
                                userEmail: currentUser.email,
                                userId: currentUser.uid,
                                syncedFromLocal: true
                            }).then(() => {
                                console.log('Local review synced to Firebase');
                                // Remove from local storage after successful sync
                                const updatedReviews = localReviews.filter(r => r.timestamp !== review.timestamp);
                                localStorage.setItem('tasteviva_reviews', JSON.stringify(updatedReviews));
                            });
                        }
                    });
                }
            } catch (e) {
                console.log('No local reviews to sync');
            }
        }

        // --- Other Functions ---
        function whatsappRedirect(reason) {
            const url = `https://wa.me/923194879958?text=Hello Taste Viva Life, I have a ${reason}.`;
            window.open(url, '_blank');
        }

        function contactService(service) {
            const url = `https://wa.me/923194879958?text=I want to buy service: ${service}.`;
            window.open(url, '_blank');
        }

        function searchFun() {
            const filter = document.getElementById('recipeSearch').value.toUpperCase();
            const cards = document.querySelectorAll('.recipe-card');
            
            cards.forEach(card => {
                const title = card.querySelector('h3').textContent.toUpperCase();
                if (title.indexOf(filter) > -1) {
                    card.style.display = "";
                } else {
                    card.style.display = "none";
                }
            });
        }

        // --- Initialize on Load ---
        document.addEventListener('DOMContentLoaded', function() {
            loadRecipes();
            updateAuthUI();
            initializeDatabase();
            initStarRating();  // Initialize star rating system
            
            // Check Firebase connection
            const connectedRef = db.ref(".info/connected");
            connectedRef.on("value", function(snap) {
                if (snap.val() === true) {
                    console.log("Firebase Connected ✓");
                } else {
                    console.warn("Firebase Not Connected");
                }
            });
            
            // Close modal when clicking outside
            window.onclick = function(event) {
                const modal = document.getElementById('authModal');
                if (event.target == modal) {
                    closeAuth();
                }
            }
            
            // Enter key in search
            document.getElementById('recipeSearch').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchFun();
                }
            });
            
            // Auto-sync local reviews when user logs in
            auth.onAuthStateChanged((user) => {
                if (user) {
                    setTimeout(syncLocalReviews, 2000);
                }
            });
            
            // Track banner impression on load
            setTimeout(() => {
                if (document.getElementById('premiumBannerAd')) {
                    console.log('Banner ad impression recorded - Optimal CTR placement');
                }
            }, 1500);
            
            // Add form validation
            const reviewText = document.getElementById('reviewText');
            reviewText.addEventListener('input', function() {
                if (this.value.length < 10 && this.value.length > 0) {
                    this.style.borderColor = '#ff4757';
                } else {
                    this.style.borderColor = '#ddd';
                }
            });
        });
    </script>
    
</body>
</html>